{% extends 'base_site.html' %}

{% block header %}
    {% load humanize %}
    {% if messages %}
        {% for message in messages %}
        <div{% if message.tags %} class="alert alert-{{ message.tags }}"{% else %} class="alert alter-info"{% endif %} role="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <h1>Orden #{{ order.order_op_number }} <small> {{ order.order_description }}</small></h1>
{% endblock %}

{% block content %}
    <br>
    <p><strong>Cliente:  </strong>{{ order.order_client }}</p>
    <p><strong>M치quina:  </strong>{{ order.order_machine }}</p>
    <p><strong>Cantidad: </strong>{{ order.order_quantity }}</p>
    <p><strong>Pliegos:  </strong>{{ order.order_total_sheets }}</p>
    <p><strong>Procesos: </strong>
    <ul>
        {% for order_process in order_process_list %}
        <li>
            {{ order_process.process }}
            <ul>
                {% if not order_process.get_is_finished %}
                <li><strong>Fecha comenzado: </strong>{{ order_process.get_datetime_started|naturaltime|default_if_none:"---" }}</li>
                <li><strong>Fecha terminado: </strong>{{ order_process.get_datetime_finished|naturaltime|default_if_none:"---" }}</li>
                <li>
                {% if not order_process.get_is_started and not order_process.get_is_finished %}
                <form method="POST" action="{% url 'control_produccion:order_start_process' order.id order_process.process.id %}">{% csrf_token %}
                    <button id="btn-start-process-{{ order_process.process.id }}" class="btn btn-default" type="submit">Comenzar proceso</button>
                </form>
                {% elif order_process.get_is_started and not order_process.get_is_finished %}
                <form method="POST" action="{% url 'control_produccion:order_finish_process' order.id order_process.process.id %}">{% csrf_token %}
                    <button id="btn-finish-process-{{ order_process.process.id }}" class="btn btn-default" type="submit">Terminar proceso</button>
                </form>
                {% endif %}
                {% else %}
                <li><strong>Duraci칩n: </strong>{{ order_process.get_datetime_started|timesince:order_process.get_datetime_finished }}</li>
                {% endif %}
            </ul>
        </li>
        {% endfor %}
    </ul>

    <br>
    <p><a class="btn btn-default" href="{% url 'control_produccion:orders' %}">Ver todas las 칩rdenes</a></p>
    <p><a class="btn btn-default" href="{% url 'control_produccion:index' %}">P치gina principal</a></p>
{% endblock %}
